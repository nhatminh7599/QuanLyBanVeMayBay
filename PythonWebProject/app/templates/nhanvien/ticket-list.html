{% extends 'base.html' %}

{% block body %}
<body onload="getData()">
{{diemdi}} {{diemden}} {{ngaykhoihanh}} {{maloaive}}
<div id="demo"></div>
<div class="container">
    <div class="section-top-border">
        <h3 class="mb-30">{{diemdi}} ---> {{diemden}}</h3>
        <div class="">
            <div class="progress-table" id="table">
                <div class="table-head">
                    <div class="serial">Chuyến bay</div>
                    <div class="country">Điểm khởi hành</div>
                    <div class="visit">Điểm đến</div>
                    <div class="visit">Thời gian bay</div>
                    <div class="visit">
                        <a class="dropdown-toggle" href="" type="button" id="dropdownMenuButton"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Sắp xếp
                        </a>
                        <div class="dropdown-menu txt-style-8" aria-labelledby="dropdownMenuButton">
                            <a class="dropdown-item txt-style-9" href="#">Giá thấp nhất</a>
                            <a class="dropdown-item txt-style-9" href="#">Thời gian bay ngắn nhất</a>
                            <a class="dropdown-item txt-style-9" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <div class="table-row">
                    <div class="serial">01</div>
                    <div class="country"><img src="static/img/elements/f1.jpg" alt="flag">Canada</div>
                    <div class="visit">645032</div>
                    <div class="visit">645032</div>
                    <div class="visit txt-style-5">
                        <div style="color: #ccc; font-weight: 500;">
                            <span class="txt-style-6">123.490 VND</span>/khách
                        </div>
                        <a href="{{ url_for('ticket_detail') }}" class="btn btn-warning txt-color-3">Chọn vé</a>
                    </div>
                </div>
                <div class="table-row">
                    <div class="serial">02</div>
                    <div class="country"><img src="static/img/elements/f1.jpg" alt="flag">Canada</div>
                    <div class="visit">645032</div>
                    <div class="visit">645032</div>
                    <div class="visit txt-style-5">
                        <div style="color: #ccc; font-weight: 500;">
                            <span class="txt-style-6">123.490 VND</span>/khách
                        </div>
                        <a href="{{ url_for('ticket_detail') }}" class="btn btn-warning txt-color-3">Chọn vé</a>
                    </div>
                </div>
                <div class="table-row">
                    <div class="serial">03</div>
                    <div class="country"><img src="static/img/elements/f1.jpg" alt="flag">Canada</div>
                    <div class="visit">645032</div>
                    <div class="visit">645032</div>
                    <div class="visit txt-style-5">
                        <div style="color: #ccc; font-weight: 500;">
                            <span class="txt-style-6">123.490 VND</span>/khách
                        </div>
                        <a href="{{ url_for('ticket_detail') }}" class="btn btn-warning txt-color-3">Chọn vé</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>

<script>
        function getData () {
            fetch("http://127.0.0.1:5000/api/lich-chuyen-bay", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "diemdi": {{madiemdi}},
                    "diemden": {{madiemden}},
                    "ngaykhoihanh": "{{ngaykhoihanh}}",
                    "loaive": {{maloaive}}
                })
            }).then(res => res.json()).then(res => {
                data = res.data
                row = document.getElementById("table")
                data.forEach(e => {
                    let giave = Number(`${e.soghetrong[0].giave}`)
                    url = "{{ url_for('ticket_detail') }}" + `?machuyenbay=${Number(`${e.machuyenbay}`)}&maloaive=${e.soghetrong[0].maloaive}&giave=${giave}`
                    console.info(url)
                    giave = (giave).toFixed(1).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                    giave = giave.substring(0, giave.length - 2)
                    row.innerHTML += `<div class="table-row">
                                        <div class="serial">${e.tenchuyenbay}</div>
                                        <div class="country">${e.sanbaycatcanh}</div>
                                        <div class="visit">${e.sanbayhacanh}</div>
                                        <div class="visit">${e.thoigianbay}</div>
                                        <div class="visit txt-style-5">
                                            <div style="color: #ccc; font-weight: 500;">
                                                <span class="txt-style-6">${giave} VND</span>/khách
                                            </div>
                                            <a href=${url} class="btn btn-warning txt-color-3">Chọn vé</a>
                                        </div>
                                    </div>`
                })
                console.info(data)
            })
        }
    </script>
{% endblock %}